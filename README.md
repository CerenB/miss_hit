# MATLAB Independent, Small & Safe, High Integrity Tools

MATLAB is a popular programming language in many engineering
disciplines, intended for the fast development of prototypes. But as
we all know, prototypes make it into production all the time, so now
you're stuck. Unfortunately, there are no style checkers or "good"
static analysis tools for MATLAB. This project attempts to fill this
gap.

If you have MATLAB in your production code and want to improve code
quality then this tool-suite is for you.

## Tools

All tools are documented here:
https://florianschanda.github.io/miss_hit/

### Style Checker

A simple coding style checker and code formatter for MATLAB or Octave
code. See https://florianschanda.github.io/miss_hit/style_checker.html
for more information and a user manual.

### Code Metrics

A simple code metric tool for MATLAB or Octave code. See
https://florianschanda.github.io/miss_hit/metrics.html for more
information and a user manual.

## Challenges

There are serious issues present in the language on all levels
(lexical structure, parsing, and semantics) that make it very
difficult to create any tool processing MATLAB. The usual question is
"but what about Octave"; it is a similar language, but it is not
compatible with MATLAB. Even simple statements like `x = [1++2]` mean
different things.

### Lexing
On the lexical level MATLAB (R) and Octave are probably the one of the
[most challenging
languages](https://github.com/florianschanda/miss_hit/blob/master/LEXING_ISSUESS.md)
ever invented that aren't weird on purpose (e.g. Malbolge). We posit
that a key reason for this is that the actual MATLAB (R) parser
combines lexing and parsing in one step; which allows for some
constructs that make it impossible to use a dragon-style autogenerated
lexer. They are the only languages I know of where the lexing is
context sensitive with potentially unlimited lookahead.

The Lexer in MISS_HIT more or less complete and works
correctly. The following difficult features/bugs of the MATLAB (R) are
fully supported:

* Adding anonymous commas in matrices, so that the parser will always
  see a comma-separated row and does not have to care about
  whitespace. So `[1 1]` will be lexed to `[1, 1]`.

* Distinguishing ' (transpose) from ' (single-quoted character array)

* Support for lambda functions inside matrix/cells (think about the
  extra special treatment of whitespace in `{@(x) 1}`)

* Support for weird matrices (e.g. `[1 +1]` and `[1 ++1]` are lexed
  correctly)

* Distinguishing between matrices and assignment lists

* Command form transformation (e.g. `foo bar (baz)` is lexed as
  identifier `foo`, char array `bar`, and char array
  `(baz)`. Including the bugs/weirdness like `f) o[[ b` lexing as a
  single string. Including the really bizarre stuff like `f''] %`
  lexing as `f] ` (with a trailing space).

* Classdef blocks (e.g. `foo uint8` is not lexed as command form, but
  correctly as two identifiers).

* Block comments (with all the unspecified weirdness of nesting them
  or including text on the same line).

The notable missing features can be found in our [lexer issues](https://github.com/florianschanda/miss_hit/issues?q=is%3Aopen+is%3Aissue+label%3A%22component%3A+lexer%22).

### Parsing
Parsing is comparatively easy when compared to lexing. The main issue
is that the official documentation does not include a grammar for most
language fatures, so we had to infer one from examples, existing code,
and carefully written tests.

The parser is mostly complete, but right now it only parses (no
semantic analysis). Three of the most starred projects on github using
MATLAB (R) or Octave are processed without parse errors (matconvnet,
matlab2tikz, MatlabFunc).

I am working on ironing out some of the more obscure bugs before
moving on to basic semantic analysis (starting with name resolution
and basic type analysis).

### Semantics
The number one issue. The MathWorks has not published semantics for
MATLAB, and the documentation is extremely poor for issues surrounding
language semantics. For example, [the description for
division](https://uk.mathworks.com/help/matlab/ref/rdivide.html) never
mentions division by zero.

The plan is to come up with a language subset `MISS_HIT` that is a
safe over-approximation of MATLAB (R), and publish that as the
intended sematics. This can be combined with a carfully constructed
qualification test-suite that can demonstrate that any given version
of MATLAB (R) performs correctly on the `MISS_HIT` subset.

This approach is more or less what you do when you qualify a tool or
compiler for use in your safety critical project.

## Road map

This project is a labour of love (or hate, the two have been remarked
on being sufficiently similar by many philosophers). Progress will not
be amazingly fast. Things I intend to publish, not necessarily in this
order:

* A grammar for a subset of the language accepted by MATLAB (R) or
  Octave. The MATLAB (R) code generator requires a subset anyway, so
  most people are used to the idea of subsets already.

* A lexer and parser for this subset, written in Python.

* Safe semi-formal semantics, which may not be the officially correct
  ones, but which should over-approximate the real ones. This means
  that they may be much stricter than what you might be able to do,
  but if the tool indicates it's safe here then it's safe for real
  too.

* A style checker in the tradition of simple lint tools (checks
  indentation, naming schemes, white space).

* A data-flow analysis tool to detect e.g. unused or uninitalised
  variables.

* A code generator (intended targets C and SPARK) that precisely
  follows the documented semi-formal semantics.

* A VC generation tool (either under-approximate BMC or deductive).

* A qualification pack that maps the semi-formal semantics we decided
  to any specific MATLAB (R) version, demonstrating that the semantics
  are precisely correct or a safe over-approximation.

## Copyright

The vast majority of this work is (C) Florian Schanda and is licensed
under the GNU GPL version 3 as described in LICENSE.

Contributions from the following people and entities are under their
copyright, with the same license:

* Zenuity AB
* Alina Boboc

### Copyright of octave tests

This project includes modified/adapted parts of the GNU Octave
testsuite under `tests/parser/octave_*`. These are (c) their original
authors. Each file there describes from which file they derive.

### Note on parser tests

Some of the parser tests include code samples and documentation
snippets from the publically available MathWorks website. An
attribution (in comment form) is always included in these cases.

### Note on the documentation assets

The documentation uses
[feather icons](https://github.com/feathericons/feather/blob/master/LICENSE)
which are licensed under the MIT License.
